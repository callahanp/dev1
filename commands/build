#!/bin/bash

# if the suite is found, execute the build script in 
# the project_directory of the suitegiven in $1. 
# pass the entire list of command line parameters 
# and options to that script.

# Errors:
#   - Environment not set for DEV1
#   - Project not found among the suites
#   - Build script not found in the project
if [[ ! "$DEV1_DEBUG" == "" ]]; then
  echo "starting $DEV1/commands/build $@"
  set -x
fi
parameters="$@"
context_parameters=${parameters%--*}
source $DEV1/commands/context $context_parameters
parameters="${parameters/${context}--/}"
build_options=${parameters%--*}
build_targets=${parameters#*--}
if [[ "$build_options" == "$build_targets" ]]; then 
  unset build_targets
fi
echo "cd $PWD"
dev_dir=$(pwd)/${current_suite}dev
if [[ -e /build.sh ]]; then
  build_script="./build.sh "
elif [[ -e ${dev_dir}/build.sh ]]; then
  build_script=$dev_dir/build.sh
fi
if [[ "$build_script" != "" ]]; then
cmd="$dev_dir/build.sh  $build_options -- $build_targets"
echo $cmd
$cmd
else
 echo "Did not find a build.sh file in $pwd"
fi

if [[ ! "$DEV1_DEBUG" == "" ]]; then
  echo "ending  DEV1/commands/build $@"
  set +x
fi